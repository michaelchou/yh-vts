<html>
<head>
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=gb2312" />
<title>借记卡/存单折重置密码</title>
<LINK REL=stylesheet HREF="../Terminal/Style/Default/Style.css" type="text/css" />
<script type="text/javascript">
var isReturn = false;
function doMouseDown() {
	top.wins.clickDEvent(top.MainFrame.document, event.srcElement.name, "Menu_Right1");
}
// 初始化本次服务流程
top.serviceCtrl.prepare4Entrance(document, window, function() {
	serverEntrance();
});

// 禁止页面其他非输入控件的元素获得焦点
document.attachEvent("onclick", checkEvent);
document.attachEvent("ondblclick", checkEvent);
document.attachEvent("onfocusin", checkEvent);
document.attachEvent("onkeypress", checkEvent);
//影像上传
var imageType = "";  //上送影像平台类型
var queryImageType = ""; //查询影像平台类型
//是否是存单
var isCDSFlag = false;
var	isCard = false;
var isPassBook = false;
var isCDSCheck = 0;
var isPadCheck = false;
var isPassReader =false;
function checkEvent() {
	try {
		var arr = new Array(
			new Array(oLInfoConfigTip, "input_tel"),
			new Array(InputPassword1, "input_Password1"),
			new Array(InputPassword2, "input_Password2")
		);
		for (var i = 0; i < arr.length; i++) {
			if (arr[i][0].style.visibility.toLowerCase() == "visible") {
				top.wins.checkEvent(event.srcElement, arr[i][1]);
				break;
			}
		}
	} catch (e) {
	}
}
  // 服务流程处理入口
  function serverEntrance() {
	top.pool.set("pwdReset","1");//设置首页按钮退卡
	if (typeof(top.YHAXIDCardReader) == "undefined" || top.YHAXIDCardReader.StDeviceStatus != "HEALTHY")
	{
		onServiceFailed(top.langcur.oResetPasswordFail, top.TERMRETCODE_CARD_NOCARDDISPERSER, top.langcur.oNoIDCardReader);
	}else if(new top.CheckCard().cardSignStatus() !="true"){
		onServiceFailed(top.langcur.oResetPasswordFail, top.TERMRETCODE_CARD_NOCARDDISPERSER, new top.CheckCard().cardSignStatus());
	//}else if(typeof(top.YHAXFingerScanner) == "undefined" || top.YHAXFingerScanner.StDeviceStatus != "HEALTHY"){
	//	onServiceFailed(top.langcur.oResetPasswordFail, top.TERMRETCODE_CARD_NOCARDDISPERSER, "指纹仪模块故障");
	}
	else{
		isPassReader =false;
		top.pool.set("strNavigate2Url", "");
		//如果前插卡,直接去重置密码
		if(top.cardreader.isCardPresent()){
			acceptIDCard();
		}else{
			TypeSelect();
		}

	}
  }
  //介质选择：卡、存折、存单
  function TypeSelect()
  {
	window.operateCtrl.disableInput(true);
    top.serviceCtrl.stopUserTimeout();
	if(typeof(top.YHAXPassbook) == "undefined"){
		oTypePass.style.visibility = "hidden";
	}
	onKey_F6 = function()
	{
		isCDSFlag = true;
		//插入身份证
		acceptIDCard();
	}
	onKey_F7 = function()
	{
		isPassBook = true;
		//选择是刷折还是插入存折
		PassTypeSelect();
	}
	onKey_F8 = function()
	{
		isCard = true;
		//卡
		if(top.cardreader.isCardPresent()){
			acceptIDCard();
		}else{
			insertCard();
		}
	}
	onKey_Cancel = onKey_F98 = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	onTimeout = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	try{top.soundPlayer.playback("/Sound/SelectMediaType.mp3");}catch(e){}
	window.operateCtrl.enableInput();
    top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oSelectTypeTick);
	top.wins.showMain("oLCashSelect");
  }
	//介质选择：插存折、刷存折
	function PassTypeSelect() {
		window.operateCtrl.disableInput(true);
		top.serviceCtrl.stopUserTimeout();

		onKey_F7 = function() {
			if (top.YHAXPassbook.StDeviceStatus != "HEALTHY" || top.YHAXPassbook.StMediaStatus != "NOTPRESENT") {
				//无存折模块
				isPassBook = false;
				onServiceFailed("交易失败", "", "存折模块故障");
			}else {
				isPassBook = true;
				insertPass();
			}
		}
		
		//刷折
		onKey_F9 = function() {
		    top.journalPrinter.addJournalWithTime("选择刷折");
		    top.serviceCtrl.stopUserTimeout();
		    if(typeof(top.YHAXPassbookReader) == "undefined"){
		    	onServiceFailed("交易失败",top.TERMRETCODE_CARD_FAILED, top.langcur.oNoPassbookReader);
		    }else{
				if (top.YHAXPassbookReader.StDeviceStatus != "HEALTHY") {
					//无存折模块
					onServiceFailed("交易失败", "", "刷折模块故障");
				}else {
					passbookReader();
				}	
		    }
		}
		onKey_Cancel = onKey_F98 = function() {
			serverEntrance();
		}
		onTimeout = function() {
			top.serviceCtrl.navigate2Quit();
		}
		
		isPassBook = false;
		//显示安全退出及返回Home的功能
		oLSafeQuit.style.visibility = "visible";
		oLGoHome.style.visibility = "visible";
		try{top.soundPlayer.playback("/Sound/SelectMediaType.mp3");}catch(e){}
		window.operateCtrl.enableInput();
		top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout, oTypeSelectTick);
		top.wins.showMain("oLTypeSelect");
	}
	//刷折功能
	function passbookReader(){
		window.operateCtrl.disableInput(true);
		top.serviceCtrl.stopUserTimeout();
		onMediaInserted = function() {
			top.serviceCtrl.stopUserTimeout();
			top.wins.showProcessingTip(top.langcur.oReadPassbookInfo);
		}
		onMediaInvalid = function() {
			top.serviceCtrl.stopUserTimeout();
			onServiceFailed("刷折失败","",top.langcur.oPassbookErro2);
		}
		notSupportPassbook = function() {
			top.serviceCtrl.stopUserTimeout();
			onServiceFailed("刷折失败","",top.langcur.oReadPassbookNotSupport);
		}
		onDeviceError_Pbp = function() {
			top.serviceCtrl.stopUserTimeout();
			onServiceFailed("刷折失败","",top.langcur.oPassbookErro1);
		}
		onMediaAccepted = function(track2Val) {
			if (track2Val != null && track2Val != "") {
				if (track2Val.split("=").length < 4) {
					notSupportPassbook();
					return;
				}
				//二磁道
				top.pool.set("strTrack3", track2Val);
				top.pool.set("strVoucherNo", track2Val.split("=")[3].substr(16, 8));
				top.pool.set("strVoucherType", track2Val.split("=")[3].substr(0, 4));
				//截取折号
				track2Val = track2Val.split("=")[2].substr(0, 17);
				top.pool.set("strPassBookNum", track2Val);
				top.pool.set("DestPan", track2Val);
				isPassBook = true;
				isPassReader = true;
				//存折验密
				top.serviceCtrl.doWithProcessingAd(top.trans.send901606Async);			}
		}
		onKey_F98 = onKey_Cancel = onTimeout = function() {
			top.passbookreader.cancelAccept();
			top.serviceCtrl.navigate2Quit();
		}
		
		//屏蔽安全退出及返回Home的功能
		oLSafeQuit.style.visibility = "hidden";
		oLGoHome.style.visibility = "hidden";
		top.passbookreader.accept();
		// 播放提示音
		try{top.soundPlayer.playback("/Sound/PlsReadPass.mp3");}catch(e){}
		top.serviceCtrl.startUserTimeout(onKey_F98, top.iUserTimeout, oReadPassTick);
		// 在广告加载完成前显示默认空闲提示
		top.wins.showMain("oLPassReaderTip");
	}
  //存折重置密码流程
  function insertPass()
  {
    window.operateCtrl.disableInput(true);
    top.serviceCtrl.stopUserTimeout();
	onMediaInserted = function()
	{
		top.serviceCtrl.stopUserTimeout();
		top.wins.showProcessingTip(top.langcur.oReadPassbookInfo);
	}
	onMediaInvalid = function(){
		top.serviceCtrl.stopUserTimeout();
		top.wins.showMain("cLInfoTip2");
		try{document.all.item("cLInfoContent2").innerHTML = top.langcur.oPassbookErro2;}catch(e){}
		top.serviceCtrl.startUserTimeout(backIdle, top.iFailedTimeout, oInfoTip2Tick);
	}
	notSupportPassbook = function(){
		top.serviceCtrl.stopUserTimeout();
		top.wins.showMain("cLInfoTip2");
		try{document.all.item("cLInfoContent2").innerHTML = top.langcur.oReadPassbookNotSupport;}catch(e){}
		top.serviceCtrl.startUserTimeout(backIdle, top.iFailedTimeout, oInfoTip2Tick);
	}
	onDeviceError_Pbp=function(){
		top.serviceCtrl.stopUserTimeout();
		top.wins.showMain("cLInfoTip2");
		try{document.all.item("cLInfoContent2").innerHTML = top.langcur.oPassbookErro1;}catch(e){}
		top.passbookprinter.reset();
		top.serviceCtrl.startUserTimeout(backIdle, top.iFailedTimeout, oInfoTip2Tick);
	}
    onMediaAccepted = function(track2Val)
	{
		if( track2Val != null && track2Val != "")
		{
			if(track2Val.split("=").length<4){
				notSupportPassbook();
				return;
			}
			top.pool.set("strTrack3", track2Val);
			top.pool.set("strVoucherNo",track2Val.split("=")[3].substr(16,8));
			top.pool.set("strVoucherType",track2Val.split("=")[3].substr(0,4));
			//截取折号
			track2Val = track2Val.split("=")[2].substr(0,17);
			top.pool.set("strPassBookNum", track2Val);
			top.pool.set("DestPan", track2Val);
		
			//插入身份证
		  	//acceptIDCard();
			//ejectPassbook();
			top.serviceCtrl.doWithProcessingAd(top.trans.send901606Async);
		}
    }
 	onTimeout = function()
	{
	    //超时关闭存折机
		top.passbookprinter.cancelAccept();
		top.serviceCtrl.navigate2Quit();
	}
 	 //屏蔽安全退出及返回Home的功能
	 oLSafeQuit.style.visibility = "hidden";
	 oLGoHome.style.visibility = "hidden";
     top.passbookprinter.accept();
	 // 播放提示音
	 try {top.soundPlayer.playback("/Sound/InPutbankbook.mp3");} catch (e) {}
	 top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oInPassTick);
	 // 在广告加载完成前显示默认空闲提示
	 top.wins.showMain("oLPassTip");
  }

//先退折
function ejectPassbook(){
	top.serviceCtrl.stopUserTimeout();
	onPrintTaken = function() {
		acceptIDCard();
	}
	onPrintEjected = function() {
		top.wins.showMain("cLInfoTip2");
		try{document.all.item("cLInfoContent2").innerHTML = top.langcur.oTakePassbook;}catch(e){}
		top.serviceCtrl.startUserTimeout(backIdle, top.iUserTimeout, oInfoTip2Tick);
	}
	top.passbookprinter.eject();
}

function backIdle(){
top.serviceCtrl.stopUserTimeout();
    if(typeof(top.YHAXPassbook) != "undefined"){
        //if(top.YHAXPassbook.StDeviceStatus == "HEALTHY" && top.YHAXPassbook.StMediaStatus == "PRESENT"){
       if (top.YHAXPassbook.StMediaStatus == "PRESENT")
       {
            top.passbookprinter.eject();
			top.passbookprinter.PassbookEvents.clearAll();
        }
        top.serviceCtrl.navigate2Idle();

    }else{
            top.serviceCtrl.navigate2Idle();
    }
    onAcceptCancelled=function(){
        top.serviceCtrl.navigate2Idle();
    }
    onPrintTaken=function(){
        top.serviceCtrl.navigate2Idle();
    }
    onTimeout=function(){//退折操作超时
        top.serviceCtrl.navigate2Idle();
    }
}
  //卡重置密码流程
  function insertCard()
  {
    onCardAcceptCancelled = function()
    {
		top.serviceCtrl.navigate2Quit();
    }
	onKey_Cancel = onKey_F98 = function()
	{
		if (top.cardreader.isCardPresent()){
		   return;
		}
		top.cardreader.cancelAccept();
	}
    //超时退出
    onTimeout = function()
    {
	   top.serviceCtrl.navigate2Quit();
    }
	onCardInserted = function()
	{
		top.wins.showNewProcessingTip(top.langcur.oReadingCard);
	}
    onCardInvalid = function()
    {
       var strtip = top.langcur.oCardInvalid;
  	   top.wins.showInfoTip(strtip);
 	   top.serviceCtrl.startFlowCtrlTimeout(onCardAcceptCancelled, 10*1000);
    }
    onICCardInitFailed = function()
    {
       var strtip = "对不起,读取IC卡失败！";
  	   top.wins.showInfoTip(strtip);
 	   top.serviceCtrl.startFlowCtrlTimeout(onCardAcceptCancelled, 10*1000);
    }
	onDeviceError_Idc = function()
	{
		// 记录终端流水
		var strJrn = new top.StringCtrl("读卡器故障 "+new top.DateTimeCtrl().getYYYYMMDDHHmmSSWithSep()).preandsufStr('=', top.journalPrinter.TITLEWIDTH) + top.journalPrinter.strNewLine;
		top.journalPrinter.addJournal(strJrn);
		//返回退卡页面
		top.serviceCtrl.navigate2Quit();
	}
	onCardAccepted = function()
	{
		//验卡
		validateCard();
	}
	//屏蔽安全退出及返回Home的功能
	oLSafeQuit.style.visibility = "hidden";
	oLGoHome.style.visibility = "hidden";
	// 播放提示音
	try{top.soundPlayer.playback("/Sound/InsertCardTip.mp3");}catch(e){}
	top.cardreader.accept(120);
	top.serviceCtrl.startUserTimeout(onKey_F98, top.iUserTimeout,oInpCardTick);
	top.wins.showMain("oLIdleTip");
  }
/*
  开始验卡
 */
  function validateCard()
  {
	var strTrack2 = top.pool.get("strTrack2");
	var strTrack3 = top.pool.get("strTrack3");
	if (strTrack2.length < 6 && strTrack3.length < 6)
	{
		onServiceFailed(top.langdef.oValidateCardFailed, "", top.langdef.oInvalidCard);
	}
	//验卡类型
	top.serviceCtrl.doWithProcessingAd(top.trans.send901606Async);

  }

//验卡成功
function onVerifyServiceSuccessful(){
	var cardType = top.exchxmlasync.msgxmldomResp.getElementValue("F24");
	if("00" == cardType.substr(0,2)){
		top.pool.set("strCardType","1");
	}else if("10" == cardType.substr(0,2)){
		top.pool.set("strCardType","3");
	}else{
		top.pool.set("strCardType","2");
	}
	
	if(isPassBook){
		//判断存折账户状态
		var acctStatus = top.exchxmlasync.msgxmldomResp.getElementValue("/TransMsg/dataList/F60/acctStatus");
		if("00" == acctStatus){
			//刷折
			if(isPassReader){
				acceptIDCard();
			}else{
				ejectPassbook();
			}
		}else{
			onServiceFailed("交易失败", "", "存折账户状态不正常");
		}
		return;
	}
	
	if(top.pool.get("strCardType")== "1")
	{
		top.pool.set("isPersonal","1");
		//插入身份证
		acceptIDCard();
	}else{
		//重新插卡
		reInsertCard();
	}
}

  //重新插入借记卡
  function reInsertCard()
  {
	if(top.pool.get("strCardType")== "2")
	{
		oReInsertDebCard.innerHTML = "对不起，暂不支持他行卡";
	}
	onCardEjected = function()
	{
		top.serviceCtrl.startTipTick(top.iUserTimeout, oTakeInvalCardTick);
		// 播放提示音
		try{top.soundPlayer.playback("/Sound/TakeCardTip.mp3");}catch(e){}
		top.wins.showMain("oLTakeInvalCardTip");
	}
	onCardTaken = function()
	{
		insertCard();
	}
	onDeviceError_Idc = function()
	{
		if (top.cardreader.isCardPresent()){
		   top.YHAXCardReader.Capture();
		}
	onServiceFailed(top.langcur.oResetPasswordFail, top.TERMRETCODE_CARD_FAILED, top.langcur.oCardReaderErro);
	}
	onCardCapturedTipEnd = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	onCardCaptured = function()
	{
		top.pool.set("printType","3");//选择打印的凭条类型
		top.receiptprinter.printAndEject();
		top.wins.showInfoTip(top.langcur.oCardCapturedTip);
		top.serviceCtrl.startFlowCtrlTimeout(onCardCapturedTipEnd, 15 * 1000);
	}
	//退卡前屏蔽安全退出及返回Home的功能
	oLSafeQuit.style.visibility = "hidden";
	oLGoHome.style.visibility = "hidden";
	top.cardreader.eject();
  }

  // 允许读取身份证
  function acceptIDCard()
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	onDeviceError_ID = onTimeout_ID = onCardInvalid_ID = function() {
		onServiceFailed(top.langcur.oResetPasswordFail, top.TERMRETCODE_ID_READFAILED, top.langcur.oIDReaderFailed);
		//top.wins.showNewProcessingTip2(top.langcur.oIDReaderFailed,10,true);
		//isReturn = true;
		//setTimeout(function(){
		//	top.serviceCtrl.navigate2Quit();
		//},10000);
	}
	onCardInserted_ID = function() {
		top.wins.showNewProcessingTip(top.langcur.oReadingIDCard);
	}
	onCardReaded = function() {
		//退出身份证
		idCardEject();
	}
	//退出身份证读取流程
	onKey_Cancel = onKey_F98 = function() {
		//退出身份证前将插入的原卡退出
		if(top.cardreader.isCardPresent()){
			doEjectCard();
		}else{
			top.serviceCtrl.navigate2QuitID();
		}
	}
	onTimeout = function()
	{
		top.idCardReader.cancelAccept();
		if (top.idCardReader.isCardPresent()){
			isReturn = true;
			idCardEject();
		}else{
			top.serviceCtrl.navigate2Quit();
		}
	}
	//插入身份证页面屏蔽安全退出及返回Home的功能
	oLSafeQuit.style.visibility = "hidden";
	oLGoHome.style.visibility = "hidden";

	window.operateCtrl.enableInput();
	top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oIdCardTick);
	top.idCardReader.accept();
	// 播放提示音
	try {
		top.soundPlayer.playback("/Sound/PutIDCard.mp3");
	} catch (e) {}
	top.wins.showMain("oLIDCardTip");
  }
  function doEjectCard()
  {
	onCardEjected = function()
	{
		top.wins.showMain("oLTakeOldCardTip");
		top.serviceCtrl.startTipTick(top.iUserTimeout, oTakeOldCarTick);
	}
	onDeviceError_Idc = onCardTaken = function()
	{
		top.serviceCtrl.navigate2QuitID();
	}
	onCardCapturedTipEnd = function()
	{
		top.serviceCtrl.navigate2QuitID();
	}
	onCardCaptured = function()
	{
		top.pool.set("printType","3");//选择打印的凭条类型
		top.receiptprinter.printAndEject();
		top.wins.showInfoTip(top.langcur.oCardCapturedTip);
		top.serviceCtrl.startFlowCtrlTimeout(onCardCapturedTipEnd, 15 * 1000);
	}
	top.cardreader.eject();
  }
  // 提示取走二代身份证
  function idCardEject() {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	onDeviceError_ID = onTimeout_ID = function() {
		onServiceFailed(top.langcur.oResetPasswordFail, top.TERMRETCODE_ID_EJECTFAILED, top.langcur.oEjectIDFailed);
	}
	onCardTaken_ID = function() {
	}
	//超时
	onTimeout = function()
	{
		if(isReturn){
			top.serviceCtrl.navigate2Quit();
		}else{
			top.idCardReader.IDCardEvents.clearAll();
			//进行联网核查流程
			top.idCardReader.idCardTakenComplete();
		}
	}
	top.serviceCtrl.startUserTimeout(onTimeout, 10, oIdCardTakeTick);
	window.operateCtrl.enableInput();
	top.idCardReader.eject();
	// 播放提示音
	try {
		top.soundPlayer.playback("/Sound/TakeIDCard.mp3");
	} catch (e) {}
	top.wins.showMain("oLIDCardTakeTip");
  }
  //联网核查成功
  function onNetworkVirificationSuccessful(){
	if(isPassBook){
		if(top.pool.get("strIDCardNum") != "" && top.pool.get("strIDCardNum") != null && top.pool.get("strIDCardNum") == top.pool.get("strRespIDNo")) {
		
		}else {
			top.MainFrame.onServiceFailed(top.langcur.oValidateCardFailed, top.exchxmlasync.strTermRetCode, "该业务需本人办理，请取走您的存折。");
			return;
		}
	}
	//开始影像文件上传交易
	sendImageFile("IDType");
  }
  //影像文件上传交易
function sendImageFile(strImageType){
	imageType = strImageType;
	top.pool.set("strImageType", strImageType);//上传类型,后台会根据这个区分送到影像平台哪个接口
	if("IDType"==strImageType){
		top.pool.set("strImageFilePath", top.COLS_IDPHOTOS_FILEPATH);//上传的文件存储路劲
	}else{
		top.pool.set("strImageFilePath", top.COLS_ZNGYPHOTOS_FILEPATH);//上传的文件存储路劲
	}
	top.wins.showNewProcessingTip(top.langcur.oSendImage);
	top.trans.sendImageFileAsync();
}
//影像文件上传成功回调函数
function onImageFileSuccessful(){
	if("IDType" == imageType){
		TakePic();
	}else if("ZNGYType_PhotoPic" == imageType ){
		if(isCDSFlag){
			isCDSCheck = 0;
			//发起大堂经理进行审核
			queryImageURL("IDType");
		}else{
			userSign();
		}
	}else if("ZNGYType_SignPic" == imageType){
		var htmlstr = infoToPic.innerHTML;
		top.pool.set("htmlstr",htmlstr);
		oSigConfirm.style.visibility = "hidden";//签名完影藏确定按钮
		infoToPic.style.visibility = "hidden";
		top.wins.showNewProcessingTip("交易处理中，请稍候...");
		top.trans.sendBusinessApplicationAsync();
		
	}
}

//电子回单上送成功
function onSuccessful(){
	if(isCDSFlag){
		isPadCheck = true;
		//存单签名后即发送二次审核信息
		var Msg = new top.JSONCtrl();
		Msg.setJson("userAccountNum","存单号："+top.pool.get("DestPan"));
		Msg.setJson("userIDName","户名："+top.pool.get("strIDName"));
		Msg.setJson("userIDNum","身份证："+top.pool.get("strIDCardNum"));
		top.pool.set("strCheckContent",Msg.jsonStr);
		top.pool.set("strbusinessCode","001");
		top.pool.set("strbusinessName","存单密码重置");
		//进行审核
		top.wins.showNewProcessingTip(top.langcur.oCheckLoading);
		top.trans.send910301Async();
		//onCheckLoadingSuccessful();
	}else{
		//审核前URL查询
		queryImageURL("IDType");
	}
}

//图片URL查询
function queryImageURL(strImageType){
	queryImageType = strImageType;
	top.wins.showNewProcessingTip(top.langcur.oImageFileQuery);
	top.pool.set("strImageType",strImageType);
	top.trans.sendImageFileQueryAsync();
}

 //图片查询结果
function onImageFileQuerySuccessful()
{
	top.wins.stopProcessingTimeout();
	top.serviceCtrl.stopUserTimeout();
	if("IDType" == queryImageType){
		top.pool.set("idPhotoBackUrl",top.pool.get("back"));//反
		top.pool.set("idPhotoUrl",top.pool.get("Front"));//正
		//进行查询
		queryImageURL("ZNGYType");
	}else if("ZNGYType" == queryImageType){
		top.pool.set("scenePhotoUrl",top.pool.get("cameras"));//现场
		//PAD审核
		sendPadCheck();
	}
}

//PAD审核
function sendPadCheck() {
	isPadCheck = true;
 	var Msg = new top.JSONCtrl();
	if(isPassBook){
		//存折号、户名、身份证
		Msg.setJson("userPassNum","存折号："+top.pool.get("strPassBookNum"));
		
		top.pool.set("strbusinessName","存折密码重置");
	}else if(isCard){
		//借记卡号、户名、身份证
		Msg.setJson("userPassNum","借记卡号："+top.pool.get("strPan"));
		top.pool.set("strbusinessName","卡密码重置");
	}else if(isCDSFlag){
		//存单首次审核：户名、身份证
		//Msg.setJson("userPassNum","存单账号："+top.pool.get("strPan"));
		top.pool.set("strbusinessName","存单密码重置首次审核");
	}
	Msg.setJson("userIDName","户名："+top.pool.get("strIDName"));
	Msg.setJson("userIDNum","身份证："+top.pool.get("strIDCardNum"));
	top.pool.set("strCheckContent",Msg.jsonStr);
	top.pool.set("strbusinessCode","001");
	//进行审核
	top.wins.showNewProcessingTip(top.langcur.oCheckLoading);
	top.trans.send910301Async();
	//onCheckLoadingSuccessful();
  }
  //审核超时处理
  function onProcessingTimeout(){
	top.serviceCtrl.navigate2Quit();
  }
//PAD审核成功
function onCheckLoadingSuccessful(){
	if(isCDSFlag)
	{
		//存单首次审核
		if(isCDSCheck == 0)
		{
			isCDSCheck ++;
			//查询客户号下的存单
			top.pool.set("strCertType","2001");
			top.wins.showNewProcessingTip(top.langcur.sendCDSQuery);
			top.trans.send902122Async();
		}else if(isCDSCheck == 1)
		{
			//存单二次审核
			inputPin1();
		}
	}else{
		inputPin1();
	}

}
  //拍照
  function TakePic()
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	onTimeout = function()
	{
		top.cameras.display("Person","Destroy");//关闭摄像头
		top.serviceCtrl.navigate2Quit();
	}
	window.operateCtrl.enableInput();
	window.frames["ifreamPhoto"].CamerasLoad();//加载子页面摄像头相关方法
	oLSafeQuit.style.visibility = "visible";
	oLGoHome.style.visibility = "visible";
	top.wins.showMain("oLTakePicTip");
  }
  function PhotoPrevStep()//TakePhoto页面过度方法
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	top.serviceCtrl.navigate2Quit();//拍照返回后步骤
	window.operateCtrl.enableInput();
  }
  function PhotoNextStep()//TakePhoto页面过度方法
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	sendImageFile("ZNGYType_PhotoPic");
	window.operateCtrl.enableInput();
  }

  //用户签名
  function userSign()
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	oSigConfirm.style.visibility = "hidden";//隐藏确定按钮
	oSigAgain.style.visibility = "hidden";//隐藏重签按钮
	oSigFinger.style.visibility = "visible";
	oESign.style.visibility = "visible";
	text_pid2.innerHTML = top.pool.get("strIDCardNum");
	text_name2.innerHTML = top.pool.get("strIDName");
	text_ethnic2.innerHTML = top.pool.get("strIDNation");
	text_address2.innerHTML = top.pool.get("strIDAddress");

    text_strPan.innerHTML = top.pool.get("strPan");
	if(isPassBook){
		oTextStrPan.innerHTML = "存折账户号:";
		text_strPan.innerHTML = top.pool.get("DestPan");
	}else if(isCDSFlag){
		oTextStrPan.innerHTML = "存单号:";
		text_strPan.innerHTML = top.pool.get("DestPan");
	}

    text_date.innerHTML = new top.DateTimeCtrl().getYYYYMMDD2();
    text_time.innerHTML = new top.DateTimeCtrl().getHHmmSSWithSep();
    text_term.innerHTML = top.terminal.strTerminalNum
    window.frames["ifreamSign"].SignLoad();//加载子页面签名相关方法
	window.operateCtrl.enableInput();
	top.serviceCtrl.startUserTimeout(window.frames['ifreamSign'].onTimeout, top.iUserTimeout,oSigFingerTick);
    top.wins.showMain("oLUserSignTip");
  }
  function SignPrevStep()//ESign页面过度方法
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	oSigConfirm.style.visibility = "hidden";//隐藏确定按钮
	//存单返回
	if(isCDSFlag){
		SelectSubCount();
	}else{
		top.serviceCtrl.navigate2Quit();//拍照
	}
	window.operateCtrl.enableInput();
  }
  function SignNextStep()//ESign页面过度方法
  {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	oSigConfirm.style.visibility = "hidden";//签名完隐藏确定按钮
	sendImageFile("ZNGYType_SignPic");
	window.operateCtrl.enableInput();
  }

  //查询客户号下的存单成功
  function SelectSubCount()
  {
  	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	onKey_Cancel = onKey_F98 = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	//超时退出
	onTimeout = function()
	{
		top.serviceCtrl.navigate2Quit();
	}

	viewMultiRecord();
	window.operateCtrl.enableInput();
	top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oChooseOneTick);
	//显示安全退出及返回Home的功能
	oLSafeQuit.style.visibility = "visible";
	oLGoHome.style.visibility = "visible";
	top.wins.showMain("oLCDSQuerySuccessTip");
  }
 function viewMultiRecord()
{

  var mrv = new top.MultiRecordView();
  var strRecordArr = new Array();
  var strHeadingArr = new Array
  (
		top.langcur.oSerialNumber,
		top.langcur.oAccount,
		top.langcur.oVoucherNo,
		top.langcur.oVoucherDate
  );
  var strAlignArr = new Array
  (
	"center",
	"center",
	"center",
	"center"
  );

  var itemCount = top.exchxmlasync.msgxmldomResp.selectNodesCount("/TransMsg/dataList/F59/item");
  itemCount = parseInt(itemCount,10);
  for(var i=1; i<=itemCount; i++)
  {
	//存单号
    var acctNo = top.exchxmlasync.msgxmldomResp.getElementValue("/TransMsg/dataList/F59/item[" + i + "]/voucherAcctNo");
	//凭证号
	var certNo = top.exchxmlasync.msgxmldomResp.getElementValue("/TransMsg/dataList/F59/item[" + i + "]/voucherNo");
	//凭证日期
	var certDate = top.exchxmlasync.msgxmldomResp.getElementValue("/TransMsg/dataList/F59/item[" + i + "]/voucherDate");
    strRecordArr[strRecordArr.length] = new Array(
	    i,
		acctNo,
		certNo,
		certDate
	);
  }
	/*
	for(var i=1; i<=3; i++)
  {
    strRecordArr[strRecordArr.length] = new Array(
	    i,
		"6231628888888888888",
		i
	);
  }*/
  onTimeout = function()
{
	top.serviceCtrl.navigate2Quit();
}

  mrv.oTHead = oTHead;
  mrv.oTBody = oTBody;
  mrv.oMFirstPage  = oMFirstPage;
  mrv.oMPrevPage = oMPrevPage;
  mrv.oMNextPage = oMNextPage;
  mrv.oMEndPage = oMEndPage;
  mrv.strAlignArr = strAlignArr;
  mrv.strRecordArr = strRecordArr;
  mrv.strHeadingArr = strHeadingArr;
  mrv.iRowsPerPage = 10;	
  onKey_F1 = function(){mrv.onFirstPage();top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oChooseOneTick);}
  onKey_F2 = function(){mrv.onPrevPage();top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oChooseOneTick);}
  onKey_F3 = function(){mrv.onNextPage();top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oChooseOneTick);}
  onKey_F4 = function(){mrv.onEndPage();top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout,oChooseOneTick);}
  mrv.show();
}

function choosePerInformation(record){
	//保存数据:存单账号、凭证号
     top.pool.set("DestPan", record[1]);
	 top.pool.set("strVoucherNo", record[2]);
	 //客户签名
	 userSign();
}

  //第一次输入新密码
  function inputPin1() {
	top.serviceCtrl.stopUserTimeout();
	window.operateCtrl.disableInput(true);
	onPlainCancelled = function() {
		if(isPassBook){
			top.pinpad.bufferPINPassBook();
		}else if(isCard){
			top.pinpad.bufferPIN();
		}else if(isCDSFlag){
			//P端以存单号计算PIN
			top.pool.set("strPassBookNum",top.pool.get("DestPan"));
			top.pinpad.bufferPINPassBook();
		}

		window.operateCtrl.enableInput();
		top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout, oInputPassword1Tick);
		// 播放提示音
		try {
			top.soundPlayer.playback("/Sound/SetPwd1.mp3");
		} catch (e) {}
		top.wins.showMain("InputPassword1");
		input_Password1.value = "";
		input_Password1.focus();
	}
	onGetPinBlockOK = function(pinblock) {
		if (input_Password1.value.length < top.pinpad.iMinPinLen) {
			// 密码位数不足，则重新输入
			error_InputPassword1.innerHTML = top.langcur.oPlsReInputPwd;
			top.serviceCtrl.startFlowCtrlTimeout(inputPin1, 200);
			return;
		}
		top.pool.set("PinBlock1", pinblock);
		top.serviceCtrl.startFlowCtrlTimeout(inputPin2, 200);
	}
	onDeviceError_Pinpad = onPinInputTimeout = onPinCancelled = function() {
		top.serviceCtrl.navigate2Quit();//超时退卡
	}
	input_Password1.onkeypress = function() {
		error_InputPassword1.innerHTML = "&nbsp;";
	}
	//超时退出
	onTimeout = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	onKey_F98 = onKey_Cancel = function()
	{
		top.pinpad.cancelPINEntry();
		top.serviceCtrl.navigate2Quit();
	}
	//屏蔽安全退出及返回Home的功能
	 oLSafeQuit.style.visibility = "hidden";
	 oLGoHome.style.visibility = "hidden";
	top.pinpad.cancelUserEntry();//关闭明文输入
  }
  // 第二次输入密码
  function inputPin2() {
	top.serviceCtrl.stopUserTimeout();
	window.operateCtrl.disableInput(true);
	onPlainCancelled = function() {
		if(isPassBook){
			top.pinpad.bufferPINPassBook();
		}else if(isCard){
			top.pinpad.bufferPIN();
		}else if(isCDSFlag){
			//P端以存单号计算PIN
			top.pool.set("strPassBookNum",top.pool.get("DestPan"));
			top.pinpad.bufferPINPassBook();
		}

		window.operateCtrl.enableInput();
		top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout, oInputPassword2Tick);
		// 播放提示音
		try {
			top.soundPlayer.playback("/Sound/SetPwd2.mp3");
		} catch (e) {}
		top.wins.showMain("InputPassword2");
		input_Password2.value = "";
		input_Password2.focus();
	}
	onGetPinBlockOK = function(pinblock) {
		if (top.pool.get("PinBlock1") == pinblock) {
			top.pool.set("strPinBlock", pinblock);
			top.pool.set("pinblock",pinblock);
			top.pool.set("strPwdFlag", "2");
			top.wins.showNewProcessingTip(top.langcur.oSend902502);
			//设置测试数据
			//top.pool.set("strIDName","江洪卓");
			//top.pool.set("strIDCardNum","352727196707074052");
			if(isCDSFlag){
				top.pool.set("strVoucherType","2001");
			}
			// 发起重置密码交易
			top.trans.send902502Async();
		} else {
			error_InputPassword1.innerHTML = top.langcur.oPwd1NotEquaPwd2;
			top.serviceCtrl.startFlowCtrlTimeout(inputPin1, 200);
		}
	}
	onDeviceError_Pinpad = onPinInputTimeout = onPinCancelled = function() {
		top.serviceCtrl.navigate2Quit();//超时退卡
	}
	//超时退出
	onTimeout = function()
	{
		top.serviceCtrl.navigate2Quit();
		return;
	}
	onKey_F98 = onKey_Cancel = function()
	{
		top.pinpad.cancelPINEntry();
		top.serviceCtrl.navigate2Quit();
	}
	//屏蔽安全退出及返回Home的功能
	 oLSafeQuit.style.visibility = "hidden";
	 oLGoHome.style.visibility = "hidden";
	top.pinpad.cancelUserEntry();//关闭明文输入
  }

  //密码重置成功
  function reSetPWDSuccess() {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	top.pool.set("strPinBlock", top.pool.get("pinblock"));
	if(top.receiptprinter.ReceiptPrinterStatus()!="true")
	{
		oPrintReceipt.style.visibility = "hidden";
	}else
	{
		onKey_F99 = onKey_Enter = function() {
			//打印凭条
			top.pool.set("printType","13");//选择打印的凭条类型
		
			if(isCDSFlag){
				top.pool.set("printFlag","CDS");
				top.pool.set("ChPWDType","存单");
				top.pool.set("strTransCode","902502CD");
			}else if(isPassBook){
				top.pool.set("printFlag","Passbook");
				top.pool.set("ChPWDType","存折");
				top.pool.set("strTransCode","902502PBK");

			}else{
				top.pool.set("printFlag","Card");
				top.pool.set("ChPWDType","卡");
				top.pool.set("strTransCode","902502DBT");
			}
			top.serviceCtrl.navigate2PrintReceipt();
			top.pool.set("strNavigate2Url","");
		}
	}
	onKey_Cancel = onKey_F98 = function()
	{
		top.serviceCtrl.navigate2SecondMenu();
	}
	onTimeout = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	window.operateCtrl.enableInput();
	top.serviceCtrl.startUserTimeout(onTimeout, top.iUserTimeout, oServiceSuccessTick);
	if(isPassBook){
		Tip_Title.innerHTML = top.langcur.oResetPasswordSuccessPbk;
	}else if(isCDSFlag){
		Tip_Title.innerHTML = top.langcur.oResetPasswordSuccessCD;
	}else{
		Tip_Title.innerHTML = top.langcur.oResetPasswordSuccess;
	}
	//交易成功后，显示安全退出功能
	oLSafeQuit.style.visibility = "visible";
	oLGoHome.style.visibility = "visible";
	top.wins.showMain("oLServiceSuccessTip");
  }
  function onServiceFailed(title, retcode, retdesc) {
	window.operateCtrl.disableInput(true);
	top.serviceCtrl.stopUserTimeout();
	onTimeout = function()
	{
		top.serviceCtrl.navigate2Quit();
	}
	oTitle.innerHTML = title;
	oFailedRetDesc.innerHTML = retdesc;

	window.operateCtrl.enableInput();
	top.serviceCtrl.startUserTimeout(onTimeout, top.iFailedTimeout, oServiceFailedTick);
	//交易失败后，显示安全退出功能
	oLSafeQuit.style.visibility = "visible";
	oLGoHome.style.visibility = "visible";
	top.wins.showMain("oLServiceFailedTip");
  }
   function ShowKeyboard() {
	try {
		top.inputmethod.ShowDigit(870,570);  //数字等输入 1
	} catch (e) {}
  }
</script>
</head>
<body background="../Terminal/Style/Default/Img/Bg_Main_Menu2.jpg" oncontextmenu="return false" ondragstart="return false" onselectstart="return false" onselect="document.selection.empty()" oncopy="document.selection.empty()" onbeforecopy="return false" onmouseup="document.selection.empty()">
<div id="oLPassTip" class="FULLSCR" style="visibility:hidden;">
 <div class="FULLSCR">
  <span class="Tip_Tick" id="oInPassTick"></span>
  <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
    <tr><td align="center">
      <br/><br/><pre class="Tip_Title" id="oInsertPass"></pre><br/>
      <img src="../Image/InputPassBookTip.gif" width="870px" height="520px"/>
    </td></tr>
  </table>
  </div>
<span class="MENU98"><button onmousedown="setTimeout(onKey_F98,1000);" class="return" name="return"></button></span>
</div>

<div id="oLPassReaderTip" class="FULLSCR" style="visibility: hidden;">
	<div class="FULLSCR">
		<span class="Tip_Tick" id="oReadPassTick"></span>
		<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="center"><br/><br/>
					<pre class="Tip_Title" id="oReaderPass"></pre><br/>
					<img src="../Image/ReadPassBookTip.gif" width="870px" height="520px" />
				</td>
			</tr>
		</table>
	</div>
	<span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
</div>

<div id="cLInfoTip2" class="FULLSCR" style="visibility:hidden;">
  <div class="FULLSCR">
	<span class="Tip_Tick" id="oInfoTip2Tick"></span>
    <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
      <tr><td align="center">
        <br/><br/>
        <span class="Tip_Title" ID="cLInfoContent2">&nbsp;<br/><br/><br/></span>
      </td></tr>
    </table>
  </div>
</div>

<div id="oLIdleTip" class="FULLSCR" style="visibility:hidden;">
 <div class="FULLSCR">
  <span class="Tip_Tick" id="oInpCardTick"></span>
  <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
    <tr><td align="center">
      <br/><br/><pre class="Tip_Title" id="oInsertCard"></pre><br/>
      <img src="../Image/InsertCardTip.gif" width="870px" height="520px"/>
    </td></tr>
  </table>
  </div>
<span class="MENU98"><button onmousedown="setTimeout(onKey_F98,1000);" class="return" name="return"></button></span>
</div>

<div id="oLCashSelect" class="FULLSCR" style="visibility:hidden">
  <div class="FULLSCR">
	<span class="Tip_Tick" id="oSelectTypeTick"></span>
    <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td align="center">
		<br/><br/><br/><br/><br/><br/><br/><br/>
          <pre class="Tip_Title" id="oSelectType"></pre>
	      <span class="MENU5" style="left:22%;"><button onclick="javascript:onKey_F6()"  class="Menu_Right" name="oConfirm" id="oTypeCDS"></button></span>
		  <span class="MENU6" style="left:42%;"><button onclick="javascript:onKey_F7()"  class="Menu_Right" name="oConfirm" id="oTypePass"></button></span>
	      <span class="MENU7" style="left:62%;"><button onclick="javascript:onKey_F8()"  class="Menu_Right" name="oConfirm" id="oTypeCard"></button></span>
	   </td>
      </tr>
    </table>
  </div>
  <span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
</div>

	<div id="oLTypeSelect" class="FULLSCR">
		<div class="FULLSCR">
			<span class="Tip_Tick" id="oTypeSelectTick"></span>
			<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
				<tr>
					<td align="center"><br/><br/><br/><br/><br/><br/><br/><br/>
						<pre class="Tip_Title" id="oSelectType"></pre>
						<span class="MENU6_1"><button onclick="javascript:onKey_F7()" class="Menu_Passbook" name="oPassbook"></button></span>
						<span class="MENU7_1"><button onclick="javascript:onKey_F9()" class="Menu_Passreader" name="oPassbook"></button></span>
					</td>
				</tr>
			</table>
		</div>
		<span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
	</div>

<div id="oLTakeInvalCardTip" class="FULLSCR" style="visibility:hidden;">
	<span class="Tip_Tick" id="oTakeInvalCardTick"></span>
  <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
	<br/><br/><br/><br/><br/><br/><br/><br/>
	<tr class="FirstLine"><td align="center">
	  <span class="Tip_Title" id="oReInsertDebCard"></span><br/><br/>
	  <img src="../Image/TakeCardTip.gif" width="870" height="520" />
	</td></tr>
  </table>
</div>

<div id="oLTakeOldCardTip" class="FULLSCR" style="visibility:hidden;">
  <span class="Tip_Tick" id="oTakeOldCarTick"></span>
  <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
	<tr class="FirstLine"><td align="center">
	  <br/><span class="Tip_Title" id="oPlsTakeCard1"></span><span class="Tip_Title" id="oPlsTakeCard2"></span><br/><br/>
	  <img src="../Image/TakeCardTip.gif" width="870" height="520" />
	</td></tr>
  </table>
</div>

<div id="oLIDCardTip" class="FULLSCR" style="visibility: hidden;">
	<div class="FULLSCR">
		<br><br><br><br><br><br>
		<span class="Tip_Tick" id="oIdCardTick"></span>
		<table width="100%" height="100%" border="0" cellpadding="0"
			cellspacing="0">
			<tr class="FirstLine" height="100">
				<td align="center"><br /> <br /> <span class="Tip_Title" id="oInsertID"></span>
					<br /> <img src="../Image/ID_in.gif" width="870px" height="520px" />
				</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
			</tr>
		</table>
	</div>
	<span class="MENU98" ><button onclick="javascript:onKey_F98()" class="return" name="oReturn"></button></span>
</div>

<div id="oLIDCardTakeTip" class="FULLSCR" style="visibility: hidden;">
	<div class="FULLSCR">
		<br><br><br><br><br><br>
		<span class="Tip_Tick" id="oIdCardTakeTick"></span>
		<table width="100%" height="100%" border="0" cellpadding="0"
			cellspacing="0">
			<tr class="FirstLine" height="100">
				<td align="center"><br /> <br /> <span class="Tip_Title" id="oIDCardTake"></span>
					<br /> <img src="../Image/id_out.gif" width="870px" height="520px" />
				</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
			</tr>
		</table>
	</div>
</div>

<div id="oLTakePicTip" class="oLTakePicTip">
	<table width="100%" align="center" height="100%" border="0" cellpadding="0" cellspacing="0">
	<tr height="100%">
		<td align="center"><iframe id="ifreamPhoto" src="../Service/TakePhoto.html" width="100%" height="100%" frameborder="0px" marginheight="0px" marginwidth="0px" allowTransparency="true" scrolling="No"></iframe></td>
	</tr>
	</table>
</div>

<div id="oLCDSQuerySuccessTip" class="FULLSCR">
	<div class="FULLSCR"><br/><br/><br/><br/><br/><br/>
		<span class="Tip_Tick" id="oChooseOneTick"></span><br/>
		<table width="100%" border="0" cellpadding="0" cellspacing="0">
			<tr>
				<td align="center"><span class="Tip_Title" id="oPlsSelResetCDS"></span> <br /></td>
				<td>
			</tr>
			<tr>
				<td align="center">
				<br/>
				<table cellpadding="2" cellspacing="1" class="Table_Ob" id="oTable" width="80%" >
			  <thead class="Table_Head" id="oTHead"></thead>
			  <tbody id="oTBody">
			  </tbody>
			</table>
			</td>
			</tr>
		</table>
	</div>
	<span class="MMENU1" id="oMFirstPage"><button onclick="javascript:onKey_F1()" class="Menu_page" name="oFirstPage" id="oFirstPage"></button></span>
	<span class="MMENU2" id="oMPrevPage"><button onclick="javascript:onKey_F2()" class="Menu_page" name="oPrevPage" id="oPrevPage"></button></span>
	<span class="MMENU3" id="oMNextPage"><button onclick="javascript:onKey_F3()" class="Menu_page" name="oNextPage" id="oNextPage"></button></span>
	<span class="MMENU4" id="oMEndPage"><button onclick="javascript:onKey_F4()"  class="Menu_page" name="oEndPage" id="oEndPage"></button></span>
	<span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
</div>

<div id="oLUserSignTip" class="FULLSCR" style="visibility:hidden;">
   <div class="FULLSCR">
   <span class="Tip_Tick" id="oSigFingerTick"></span>
	   <br><br><br><br><br><br><br><br>
		   <table width="75%" height="5%" border="0" cellpadding="0" cellspacing="0" align="center">
					<tr>
						<td height="20px" align="center" class="Error_Title" id="oUserSign"></td>
					</tr>
		   </table>

		<div id="infoToPic">
			<table width="75%" height="20%" border="0" bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" align="center">
			<tr><td height="20px" colspan="4"></td></tr>

			<tr>
			  <td width="3%"></td>
			  <td width="68%" colspan="2">
				<fieldset>
				<legend><span id="oUserTip1"></span></legend>
				<table>
				<tr>
					<td nowrap colspan="2">&nbsp;&nbsp;<span id="oTextName"></span>&nbsp;&nbsp;<span id="text_name2"></span></td>
					<td nowrap colspan="2">&nbsp;&nbsp;<span id="oTextEth"></span>&nbsp;&nbsp;<span id="text_ethnic2"></span></td>

				</tr>
				<tr>
					<td nowrap colspan="4">&nbsp;&nbsp;<span id="oTextPid"></span>&nbsp;&nbsp;<span id="text_pid2"></span></td>
				</tr>
				<tr>
					<td nowrap colspan="4">&nbsp;&nbsp;<span id="oTextAddr"></span>&nbsp;&nbsp;<span id="text_address2"></span></td>
				</tr>
				</table>
				</fieldset>
			  </td>
			  <td width="3%"></td>
			</tr>

			<tr><td height="20px" colspan="4"></td></tr>

			<tr>
			  <td width="3%"></td>
			  <td width="68%" colspan="2">
			  <fieldset>
			  <legend><span id="oUserTip2"></span></legend>
			  <table>
                <tr>
				    <td colspan="4">&nbsp;&nbsp;<span id="oTextStrPan"></span>&nbsp;&nbsp;<span id="text_strPan"></span></td>
				</tr>
				<tr>
				    <td nowrap>&nbsp;&nbsp;<span id="oTextDate"></span>&nbsp;&nbsp;<span id="text_date"></span></td>
					<td nowrap>&nbsp;&nbsp;<span id="oTextTime"></span>&nbsp;&nbsp;<span id="text_time"></span></td>
					<td nowrap>&nbsp;&nbsp;<span id="oTextTerm"></span>&nbsp;&nbsp;<span id="text_term"></span></td>
				</tr>
				</table>
				</fieldset>
			  </td>
			  <td width="3%"></td>
			</tr>
			<tr><td height="20px" colspan="4"></td></tr>
			</table>
		</div>

			<table width="75%" height="5%" border="0" cellpadding="0" cellspacing="0" align="center">
			<tr>
		        <td colspan="2" ><iframe id="ifreamSign" src="../Service/ESign.html" width="100%" height="250px" frameborder="0px" marginheight="0px" marginwidth="0px" allowTransparency="true" scrolling="No"></iframe></td>
		    </tr>
			</table>

</div>
     <span class="MMENU8" id="oSigFinger" style="top: 75%;"><button onmousedown="top.wins.doMouseDown(event.srcElement.name);setTimeout(window.frames['ifreamSign'].finger,100);" class="Menu_Right" name="Menu_Right" >指纹验证</button></span>
	 <span class="MMENU7" id="oESign"  style="top: 75%;"><button onmousedown="top.wins.doMouseDown(event.srcElement.name);setTimeout(window.frames['ifreamSign'].ESig,100);" class="Menu_RightE" name="Menu_RightE" >电子签名</button></span>
     <span class="MMENUMiddle" id="oSigAgain" ><button onclick="javascript:window.frames['ifreamSign'].onKey_F7()" class="Menu_Right" name="oHome" id="oSign"></button></span>
     <span class="MENU98" ><button onclick="javascript:window.frames['ifreamSign'].onKey_F98()" class="return" name="return"></button></span>
     <span class="MENU99" id="oSigConfirm"><button onclick="javascript:window.frames['ifreamSign'].onKey_F99()" class="confirm" name="confirm"></button></span>
</div>

<div id="InputPassword1" class="FULLSCR" style="visibility: hidden;">
	<div class="FULLSCR">
		<span class="Tip_Tick" id="oInputPassword1Tick"></span> <br />
		<br /><br /><br />
		<table width="100%" height="100%" border="0" cellpadding="0"
			cellspacing="0">
			<tr>
				<td></td>
			</tr>
			<tr class="FirstLine">
				<td align="center"><pre class="Tip_Title" id="oInputpwd"></pre> <input
					type="password" id="input_Password1" name="input_Password1"
					size="10" maxlength=6 class="input_short" /> <br />
				<br /> <img width="600px" height="430px" src="../Image/InputPin.gif" />
					<table>
						<tr>
							<td class="Error_Title" id="error_InputPassword1"></td>
						</tr>
					</table></td>
			</tr>
		</table>
	</div>
	<span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
</div>

<div id="InputPassword2" class="FULLSCR" style="visibility: hidden;">
	<div class="FULLSCR">
		<span class="Tip_Tick" id="oInputPassword2Tick"></span> <br />
		<br /><br /><br />
		<table width="100%" height="100%" border="0" cellpadding="0"
			cellspacing="0">
			<tr>
				<td></td>
			</tr>
			<tr class="FirstLine">
				<td align="center"><pre class="Tip_Title" id="oInputpwd2"></pre> <input
					type="password" id="input_Password2" name="input_Password2"
					size="10" maxlength=6 class="input_short" /> <br />
				<br /> <img width="600px" height="430px" src="../Image/InputPin.gif" />
					<table>
						<tr>
							<td class="Error_Title" id="error_InputPassword2"></td>
						</tr>
					</table></td>
			</tr>
		</table>
	</div>
	<span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
</div>

<div id="oLServiceSuccessTip" class="FULLSCR"
	style="visibility: hidden;">
	<div class="FULLSCR">
		<span class="Tip_Tick" id="oServiceSuccessTick"></span>
		<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
			<br /><br /><br /><br /><br /><br /><br /><br />
			<tr class="FirstLine">
					<td align="center">
						<img src="../Terminal/Style/Default/Img/success.png" width="97" height="97" /></br></br>
						<span class="Tip_Title" id="Tip_Title"></span>
					</td>
				</tr>
		</table>
	</div>
	<span class="MENU98"><button onclick="javascript:onKey_F98();" class="return" name="return"></button></span>
	<span class="MENU99" ><button onclick="javascript:onKey_F99()" class="Menu_Right" name="Menu_Right" id="oPrintReceipt"></button></span>
</div>

<div id="oLServiceFailedTip" class="FULLSCR" style="visibility: hidden;">
	<div class="FULLSCR">
		<span class="Tip_Tick" id="oServiceFailedTick"></span> <br />
		<table width="100%" height="100%" border="0" cellpadding="0"
			cellspacing="0">
			<tr>
				<td align="center">
					<table cellpadding="10" cellspacing="1" class="Table_Ob"
						width="55%">
						<tr class="Table_Head">
							<td colspan="2" class="Error_Title" align="center" id="oTitle"></td>
						</tr>
						<tr class="Table_Record">
							<td id="oDescription"></td>
							<td><span id="oFailedRetDesc"></span></td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
</div>

<!--增加返回主页-->
<div id="oLGoHome" class="GoHomeTip">
<table width="100%" align="center" height="100%" border="0" cellpadding="0" cellspacing="0">
	 <tr height="100%">
		 <td align="center"><iframe src="../Service/GoHome.html" width="100%" height="100%" frameborder="0px" marginheight="0px" marginwidth="0px" allowTransparency="true" scrolling="No"></iframe></td>
	 </tr>
</table>
</div>

<!--增加滑动安全退出-->
<div id="oLSafeQuit" class="SafeQuitTip">
<table width="100%" align="center" height="100%" border="0" cellpadding="0" cellspacing="0">
	 <tr height="100%">
		 <td align="center"><iframe src="../Service/SafeQuit.html" width="100%" height="100%" frameborder="0px" marginheight="0px" marginwidth="0px" allowTransparency="true" scrolling="No"></iframe></td>
	 </tr>
</table>
</div>
</body>
</html>
